<div class="results-page">
    <div class="blur-circle blur-circle--white-large"></div>
    <div class="blur-circle blur-circle--green-top-right"></div>
    <div class="blur-circle blur-circle--blue-bottom-left"></div>

    <header class="results-header">
        <div class="results-header-inner">
            <button class="back-button" type="button" (click)="goBack()" aria-label="Volver">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path
                        d="M10.5 19.5a1 1 0 0 1-.707-.293l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 1 1 1.414 1.414L6.914 10.5H20a1 1 0 1 1 0 2H6.914l4.293 4.293A1 1 0 0 1 10.5 19.5Z" />
                </svg>
            </button>
            <div class="results-title">{{ moduleDef.resultsTitle }}</div>

            <div class="results-header-actions" aria-label="Acciones">
                <button class="icon-action" type="button" (click)="downloadResults()" aria-label="Descargar">
                    <img class="icon-action__img" src="icons/Icon (35).svg" alt="" aria-hidden="true" />
                </button>
                <button class="icon-action" type="button" (click)="shareResults()" aria-label="Compartir">
                    <img class="icon-action__img" src="icons/Icon (36).svg" alt="" aria-hidden="true" />
                </button>
            </div>
        </div>
    </header>

    <main class="results-shell" *ngIf="result as r">
        <section class="summary-card" [ngClass]="outcomeClass">
            <div class="summary-row">
                <div class="score-ring" aria-hidden="true">
                    <svg width="160" height="160" viewBox="0 0 160 160" class="ring" focusable="false" tabindex="-1" aria-hidden="true">
                        <circle cx="80" cy="80" r="68" class="ring-track"></circle>
                        <circle cx="80" cy="80" r="68" class="ring-progress" [attr.stroke-dasharray]="ringDasharray">
                        </circle>
                    </svg>
                    <div class="ring-center">
                        <div class="ring-score">{{ r.score }}</div>
                        <div class="ring-points">puntos</div>
                    </div>
                </div>

                <div class="summary-content">
                    <div class="outcome-pill">
                        <span class="outcome-icon" [ngClass]="outcomeIcon" aria-hidden="true">
                            <img *ngIf="outcomeIcon === 'check'" class="outcome-figma-icon" src="icons/Icon (6).svg"
                                alt="" />
                            <svg *ngIf="outcomeIcon === 'warn'" viewBox="0 0 24 24" class="outcome-warn-icon"
                                aria-hidden="true">
                                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" />
                                <path d="M12 7v7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    fill="none" />
                                <circle cx="12" cy="17" r="1.25" fill="currentColor" />
                            </svg>
                            <svg *ngIf="outcomeIcon === 'alert'" viewBox="0 0 24 24" class="outcome-alert-icon"
                                aria-hidden="true">
                                <path d="M12 3L22 21H2L12 3Z" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linejoin="round" />
                                <path d="M12 9v5" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" />
                                <circle cx="12" cy="17" r="1.25" fill="currentColor" />
                            </svg>
                        </span>
                        <span class="outcome-text">{{ r.headline }}</span>
                    </div>

                    <p class="summary-message">{{ r.message }}</p>

                    <div class="summary-date">
                        <svg class="calendar" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v13a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 8H4v10a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V10Z" />
                        </svg>
                        <span>{{ evaluatedDateLabel }}</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="card card--dimensions">
            <div class="card-title">
                <span class="card-title-icon" aria-hidden="true">
                    <img class="card-title-icon-img" src="icons/Icon (31).svg" alt="" />
                </span>
                <span>Desglose por dimensiones</span>
            </div>

            <div class="dimension" *ngFor="let d of r.dimensions; let idx = index">
                <div class="dimension-row">
                    <div class="dimension-label">{{ getDimensionLabel(d, idx) }}</div>
                    <div class="dimension-value" [ngClass]="getBarTone(d.percent)">{{ d.percent }}%</div>
                </div>
                <div class="bar">
                    <div class="bar-fill" [ngClass]="getBarTone(d.percent)" [style.width.%]="d.percent"></div>
                </div>
            </div>

            <p *ngIf="(r.dimensions ?? []).length === 0">
                <ng-container *ngIf="isHydrating">Cargando desglose por dimensiones...</ng-container>
                <ng-container *ngIf="!isHydrating && hydrationAttempted">No hay desglose por dimensiones disponible para este resultado.</ng-container>
            </p>
        </section>

        <section class="card card--recommendations">
            <div class="card-title">
                <span>Recomendaciones personalizadas</span>
            </div>

            <div class="rec-item" *ngFor="let item of r.recommendations; let idx = index">
                <div class="rec-badge">{{ idx + 1 }}</div>
                <div class="rec-text">{{ item }}</div>
            </div>

            <p *ngIf="(r.recommendations ?? []).length === 0">
                <ng-container *ngIf="isHydrating">Cargando recomendaciones...</ng-container>
                <ng-container *ngIf="!isHydrating && hydrationAttempted">No hay recomendaciones disponibles para este resultado.
                </ng-container>
            </p>
        </section>

        <section class="actions">
            <div class="action-card">
                <div class="action-icon action-icon--purple" aria-hidden="true">
                    <img class="action-icon-img" src="icons/Icon (32).svg" alt="" />
                </div>
                <div class="action-title">Agendar Seguimiento</div>
                <div class="action-desc">Programa una nueva evaluación en 30 días</div>
                <button class="action-btn" type="button" (click)="scheduleFollowUp()">Agendar</button>
            </div>

            <div class="action-card">
                <div class="action-icon action-icon--teal" aria-hidden="true">
                    <img class="action-icon-img" src="icons/Icon (33).svg" alt="" />
                </div>
                <div class="action-title">Apoyo Psicológico</div>
                <div class="action-desc">Conecta con un profesional de la salud</div>
                <button class="action-btn" type="button" (click)="requestSupport()">Solicitar</button>
            </div>

            <div class="action-card">
                <div class="action-icon action-icon--lime" aria-hidden="true">
                    <img class="action-icon-img" src="icons/Icon (34).svg" alt="" />
                </div>
                <div class="action-title">Recursos de Autocuidado</div>
                <div class="action-desc">Accede a herramientas y ejercicios</div>
                <button class="action-btn" type="button" (click)="openResources()">Explorar</button>
            </div>
        </section>

        <section class="help-card" *ngIf="result?.outcome === 'high-risk'">
            <div class="help-title-row">
                <span class="help-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 3L22 21H2L12 3Z" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linejoin="round" />
                        <path d="M12 9v5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <circle cx="12" cy="17" r="1.25" fill="currentColor" />
                    </svg>
                </span>
                <div class="help-title">¿Necesitas ayuda inmediata?</div>
            </div>
            <div class="help-desc">
                Si sientes que necesitas apoyo urgente, no dudes en contactarnos. Estamos aquí para ayudarte.
            </div>
            <div class="help-actions">
                <button class="help-btn help-btn--primary" type="button" (click)="openSupportChat()">Chat de apoyo</button>
            </div>
        </section>

        <div class="footer">
            <emo-button class="footer-main-btn" variant="teal" size="medium" [fullWidth]="false" (clicked)="goBack()">
                Volver al panel principal
            </emo-button>
        </div>
    </main>
</div>