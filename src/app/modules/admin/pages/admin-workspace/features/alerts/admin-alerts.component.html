<section class="admin-page">
    <header class="admin-page__header">
        <div>
            <h2>Gestión de Alertas</h2>
            <p>Monitorea incidencias críticas y registra seguimiento clínico-administrativo.</p>
        </div>
        <a routerLink="/admin" class="admin-page__back">Volver al Centro Admin</a>
    </header>

    <div class="admin-page__filters">
        <label>
            Estado
            <select [(ngModel)]="status">
                <option value="">Todos los estados</option>
                <option value="Pending">Pendientes</option>
                <option value="Attended">Atendidas</option>
            </select>
        </label>

        <label>
            Nivel
            <select [(ngModel)]="level">
                <option value="">Todos los niveles</option>
                <option value="Critical">Crítica</option>
                <option value="High">Alta</option>
                <option value="Medium">Media</option>
            </select>
        </label>

        <label>
            Fecha inicio
            <input type="date" [(ngModel)]="startDate" />
        </label>

        <label>
            Fecha fin
            <input type="date" [(ngModel)]="endDate" />
        </label>

        <button mat-flat-button color="primary" (click)="load()">Filtrar</button>
    </div>

    <div class="admin-editor" *ngIf="selectedAlert as current">
        <div class="admin-editor__title">Atender alerta #{{ current.alertId }}</div>
        <div class="admin-form-grid">
            <label>
                Acción tomada *
                <input [(ngModel)]="actionTaken" />
            </label>
            <label>
                Notas
                <textarea rows="3" [(ngModel)]="notes"></textarea>
            </label>
        </div>
        <div class="admin-editor__actions">
            <button mat-stroked-button (click)="clearSelection()">Cancelar</button>
            <button mat-flat-button color="primary" [disabled]="saving" (click)="attendSelected()">Guardar</button>
        </div>
    </div>

    <div class="admin-table" *ngIf="!loading">
        <div class="admin-row admin-row--head">
            <div>ID</div>
            <div>Nivel</div>
            <div>Tipo</div>
            <div>Estado</div>
            <div>Acción</div>
        </div>
        <div class="admin-row" *ngFor="let row of alerts" [class.admin-row--active]="row.alertId === selectedAlertId">
            <div>{{ row.alertId }}</div>
            <div>{{ row.alertLevel || '-' }}</div>
            <div>{{ row.alertType || '-' }}</div>
            <div>{{ row.isAttended ? 'Atendida' : 'Pendiente' }}</div>
            <div>
                <button mat-button (click)="selectAlert(row)">Gestionar</button>
            </div>
        </div>

        <div class="admin-empty" *ngIf="!alerts.length">No hay alertas para los filtros seleccionados.</div>
    </div>

    <div class="admin-empty" *ngIf="loading">Cargando alertas...</div>
</section>